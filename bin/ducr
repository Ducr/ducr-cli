#! /usr/bin/env node

const { chalk, program, minimist } = require('../libs/tools/module')
const packageData = require('../package.json')
const log = console.log

//å½“å‰cliçš„åç§° 
const cliName = packageData.name

console.log(chalk.yellowBright.bold(`ğŸ‘ welcome to use ${cliName}ğŸ‘`))

/**
 * å‚æ•°çš„æ ¼å¼åŒ–æ–¹æ³•
 * @param { object } cmd å½“å‰å‘½ä»¤è¡Œä¸­çš„å‘½ä»¤æ•°æ®
 */
const clearArgs = (cmd) => {
  const args = {}
  cmd.options.forEach(opt => {
    const key = opt.long.slice(2)
    // å¦‚æœå½“å‰å‘½ä»¤é€šè¿‡keyèƒ½å–åˆ°è¿™ä¸ªå€¼ï¼Œåˆ™å­˜åœ¨è¿™ä¸ªå€¼
    if (cmd[key]) {
      args[key] = cmd[key]
    }
  })
  return args
}

// åˆ›å»ºcreateå‘½ä»¤ å¹¶è¿›è¡Œæ“ä½œ
program.command('create <app-name>')
  .description("create a new project")
  .option("-f,--force", 'overwrite target if it exists') // ä¸€äº›å‚æ•°é…ç½®åŠç®€å†™å½¢å¼
  .option("-o,--owner", 'overwrite target if it exists') // ownerå‚æ•°é…ç½®åŠç®€å†™å½¢å¼
  .option("-r,--repository", 'overwrite target if it exists') // repositoryå‚æ•°é…ç½®åŠç®€å†™å½¢å¼
  .action((name, cmd) => { // è¾“å…¥æ­£ç¡®å‘½ä»¤ä¹‹åçš„æ“ä½œï¼Œname æ˜¯å‘½ä»¤ï¼Œcmd æ˜¯å‚æ•°
    if (!name) {
      log(chalk.red("please write project name"))
      return
    }
    // require('../libs/command/create.js')(name, clearArgs(cmd))
    require('../libs/command/create.js')(name, minimist(process.argv.splice(2)))
  })

// ducr-cli çš„ç‰ˆæœ¬ä¿¡æ¯
program
  .version(`${cliName}@${packageData.version}`)
  .usage('<command> [option]')

// åœ¨ --help çš„æ—¶å€™è¿›è¡Œè°ƒæ•´
program.on('--help', () => {
  log(`Run ${chalk.red(`${cliName} <command> --help`)} show details`)
})

// è§£æç”¨æˆ·æ‰§è¡Œå‘½ä»¤æ—¶å€™ä¼ å…¥çš„å‚æ•°ï¼Œæ ¹æ®å‚æ•°è¿›è¡Œé…ç½® 
program.parse(process.argv)

if (!program.args.length) {
  program.help()
}
